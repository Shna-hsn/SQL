CREATE OR REPLACE TRIGGER TRI_FPYRGROUPING
  AFTER INSERT OR UPDATE ON FPYRDETAIL
  FOR EACH ROW

DECLARE
  V_COUNT     NUMBER := 0;
  VAR_ERR_MSG VARCHAR2(2000);

BEGIN

  IF :NEW.PLANT = 'P8-F139' AND :NEW.MFGTYPE = 'FA' THEN
    SELECT COUNT(*)
      INTO V_COUNT
      FROM FPYRGROUPING
     WHERE STAGEGROUP = :NEW.STAGE;
    IF V_COUNT = 0 THEN
      INSERT INTO FPYRGROUPING
        (PLANT,
         MFGTYPE,
         STAGEGROUP)
      VALUES
        (:NEW.PLANT,
         :NEW.MFGTYPE,
         :NEW.STAGE);
    END IF;
  END IF;

EXCEPTION
  WHEN OTHERS THEN
    VAR_ERR_MSG := SQLERRM(SQLCODE);
    INSERT INTO KBNERRORLOG
    VALUES
      (SYSDATE,'FPYRDETAIL',VAR_ERR_MSG);
    ---RETURN;
END;
